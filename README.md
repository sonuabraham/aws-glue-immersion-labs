# AWS Glue Immersion Day - Local Deployment

A comprehensive AWS Glue workshop adapted for local deployment from your laptop, eliminating the need for AWS Cloud9.

## ğŸ¯ Overview

This repository contains everything you need to run the AWS Glue Immersion Day workshop from your local machine. It includes:
- Infrastructure as Code (CloudFormation templates)
- Sample data for all labs
- Setup automation scripts
- Comprehensive documentation

Originally designed for AWS Cloud9, this version has been adapted to work seamlessly from your local development environment using WSL, Linux, or macOS.

## ğŸ“ Repository Structure

```
.
â”œâ”€â”€ docs/                           # Documentation
â”‚   â”œâ”€â”€ README-LOCAL-SETUP.md      # Complete setup guide
â”‚   â”œâ”€â”€ LAB1-DATA-GUIDE.md         # Lab 1 specific instructions
â”‚   â””â”€â”€ glue-workshop-structure.md # Workshop structure reference
â”œâ”€â”€ infra/                          # Infrastructure as Code
â”‚   â”œâ”€â”€ GlueImmersionDay-LocalDeployment-v2.yaml  # Main CloudFormation template
â”‚   â””â”€â”€ GlueImmersionDay-LocalDeployment-v1.yaml  # Original template (reference)
â”œâ”€â”€ scripts/                        # Automation scripts
â”‚   â”œâ”€â”€ create-glue-workshop-zip.sh # Generate workshop data package
â”‚   â””â”€â”€ one-step-setup.sh          # Main setup script
â”œâ”€â”€ glue-workshop-labs/            # Original lab content (reference)
â”‚   â”œâ”€â”€ lab1/ through lab12/       # Individual lab exercises
â”‚   â””â”€â”€ ...
â””â”€â”€ .gitignore                     # Git ignore file

# Generated by scripts (not in repo):
â”œâ”€â”€ glue-workshop/                  # Workshop deployment package (generated)
â”‚   â”œâ”€â”€ code/                      # Glue ETL scripts
â”‚   â”œâ”€â”€ data/                      # Sample data for labs
â”‚   â”‚   â”œâ”€â”€ lab1/                  # Lab 1 data (CSV, JSON)
â”‚   â”‚   â”œâ”€â”€ lab4/                  # Lab 4 data
â”‚   â”‚   â””â”€â”€ lab5/                  # Lab 5 data (COVID-19 sample)
â”‚   â”œâ”€â”€ library/                   # Python libraries
â”‚   â”œâ”€â”€ airflow/                   # MWAA configuration
â”‚   â”‚   â”œâ”€â”€ dags/                  # Airflow DAGs
â”‚   â”‚   â”œâ”€â”€ plugins/               # Airflow plugins
â”‚   â”‚   â””â”€â”€ requirements/          # Python requirements
â”‚   â””â”€â”€ output/                    # Job output directory
â””â”€â”€ glue-workshop.zip              # Packaged workshop files (generated)
    â”œâ”€â”€ lab1/ through lab12/       # Individual lab exercises
    â””â”€â”€ ...
```

## ğŸš€ Quick Start

### Prerequisites

- **AWS CLI** configured with appropriate credentials
- **WSL** (Windows), Linux, or macOS terminal
- **AWS Account** with permissions to create:
  - VPC, Subnets, Security Groups
  - RDS instances
  - S3 buckets
  - Glue resources (databases, tables, crawlers, jobs)
  - IAM roles and policies
  - MWAA environments
  - CloudTrail, SQS, Kinesis, SNS

### Setup in 3 Steps

1. **Deploy Infrastructure**
   ```bash
   aws cloudformation create-stack \
     --stack-name glue-workshop \
     --template-body file://infra/GlueImmersionDay-LocalDeployment-v2.yaml \
     --capabilities CAPABILITY_NAMED_IAM \
     --region <your-region>
   ```

2. **Generate Workshop Data**
   ```bash
   cd scripts
   chmod +x create-glue-workshop-zip.sh
   ./create-glue-workshop-zip.sh
   cd ..
   zip -r glue-workshop.zip glue-workshop/
   ```
   
   This creates the `glue-workshop/` folder with all sample data and the `glue-workshop.zip` package.

3. **Run Setup Script**
   ```bash
   mkdir -p ~/environment
   cp glue-workshop.zip ~/environment/
   cd ~/environment
   chmod +x scripts/one-step-setup.sh
   ./scripts/one-step-setup.sh "local"
   ```

## ğŸ“š Documentation

- **[Local Setup Guide](docs/README-LOCAL-SETUP.md)** - Complete deployment instructions
- **[Lab 1 Guide](docs/LAB1-DATA-GUIDE.md)** - Lab 1 exercises and data details
- **[Workshop Structure](docs/glue-workshop-structure.md)** - Understanding the data layout

## ğŸ“ What You'll Learn

This workshop covers:

1. **Lab 1** - AWS Glue Basics
   - Creating crawlers
   - Working with the Data Catalog
   - Querying data with Athena
   - S3 event notifications

2. **Lab 2-12** - Advanced Topics
   - ETL transformations
   - Data quality checks
   - Streaming data processing
   - Workflow orchestration with MWAA
   - Integration with RDS
   - Machine learning data preparation

## ğŸ—ï¸ Infrastructure Components

The CloudFormation template creates:

- **Networking**: VPC, Subnets, NAT Gateways, Security Groups
- **Storage**: S3 bucket with event notifications
- **Database**: RDS MySQL instance
- **Glue Resources**: Database, tables, crawlers, connections
- **Streaming**: Kinesis stream
- **Messaging**: SQS queue, SNS topics
- **Orchestration**: MWAA (Managed Airflow) environment
- **Monitoring**: CloudTrail for S3 events
- **IAM**: Service roles for Glue, DataBrew, EventBridge, Step Functions

## ğŸ“Š Sample Data Included

### Lab 1 - Sales Data
- **CSV Format**: 40 records across 2 files
- **JSON Format**: 10 records
- **Schema**: Region, Country, Item Type, Sales Channel, Revenue, Profit, etc.

### Lab 4 - JSON Data
- Sample e-commerce transactions

### Lab 5 - COVID-19 Data
- Sample COVID-19 testing data (6 records)
- Replaces inaccessible public data lake

## ğŸ”§ Key Differences from Cloud9 Version

### Removed
- âŒ Cloud9 IDE resource
- âŒ EC2 instance profile management
- âŒ Cloud9-specific security group rules
- âŒ EC2 metadata queries
- âŒ Automatic credential management

### Added
- âœ… Local credential validation
- âœ… Better error handling
- âœ… Sample data for inaccessible public datasets
- âœ… Graceful fallbacks for missing resources
- âœ… Progress indicators for uploads

### Modified
- ğŸ”„ Uses local AWS CLI credentials
- ğŸ”„ Skips Cloud9-specific setup steps
- ğŸ”„ Continues on non-critical errors

## ğŸ› ï¸ Common Tasks

### Verify Data Upload
```bash
aws s3 ls s3://${BUCKET_NAME}/input/ --recursive
```

### Create a Crawler
```bash
aws glue create-crawler \
  --name my-crawler \
  --role AWSGlueServiceRole-glueworkshop \
  --database-name glueworkshop_cloudformation \
  --targets '{"S3Targets":[{"Path":"s3://'${BUCKET_NAME}'/input/lab1/csv/"}]}'
```

### Query with Athena
```bash
aws athena start-query-execution \
  --query-string "SELECT * FROM lab1_csv_sales_data_2023_01 LIMIT 10" \
  --result-configuration "OutputLocation=s3://${BUCKET_NAME}/athena-results/" \
  --query-execution-context "Database=glueworkshop_cloudformation"
```

### Check MWAA Status
```bash
aws mwaa get-environment --name MyAirflowEnvironment
```

## ğŸ§¹ Cleanup

Remove all resources when done:

```bash
# Empty S3 bucket
aws s3 rm s3://glueworkshop-${AWS_ACCOUNT_ID}-${AWS_REGION} --recursive

# Delete CloudFormation stack
aws cloudformation delete-stack --stack-name glue-workshop --region <your-region>
```

## âš ï¸ Important Notes

- **MWAA Environment**: Takes 20-30 minutes to create
- **RDS Instance**: Takes 10-15 minutes to create
- **Costs**: Running this workshop incurs AWS charges (RDS, MWAA, NAT Gateways)
- **Region**: Use a region that supports all services (us-east-1, us-west-2 recommended)

## ğŸ› Troubleshooting

### Access Denied Errors
Expected for public S3 buckets (COVID-19 data lake). Sample data is provided as fallback.

### Missing pycountry_convert.zip
Download fails are expected. Install manually if needed:
```bash
pip install pycountry-convert
```

### AWS Credentials
Verify your credentials:
```bash
aws sts get-caller-identity
```

### Region Mismatch
Ensure consistent region usage:
```bash
export AWS_REGION=<your-region>
aws configure set region $AWS_REGION
```

## ğŸ“ Environment Variables

After setup, these are available in `~/.bashrc`:
- `BUCKET_NAME` - Workshop S3 bucket
- `AWS_REGION` - Your AWS region
- `AWS_ACCOUNT_ID` - Your AWS account ID

Reload with:
```bash
source ~/.bashrc
```

## ğŸ¤ Contributing

This is an adapted version of the AWS Glue Immersion Day workshop. Improvements and bug fixes are welcome!

## ğŸ“„ License

This workshop content is based on AWS workshop materials. Please refer to AWS terms of service for usage guidelines.

## ğŸ”— Resources

- [AWS Glue Documentation](https://docs.aws.amazon.com/glue/)
- [AWS Glue Best Practices](https://docs.aws.amazon.com/glue/latest/dg/best-practices.html)
- [Original Workshop](https://catalog.us-east-1.prod.workshops.aws/workshops/ee59d21b-4cb8-4b3d-a629-24537cf37bb5/)
- [AWS Glue Pricing](https://aws.amazon.com/glue/pricing/)

## ğŸ’¡ Tips

1. **Start Small**: Begin with Lab 1 to understand the basics
2. **Monitor Costs**: Keep an eye on RDS and MWAA costs
3. **Use Bookmarks**: Enable Glue job bookmarks to avoid reprocessing data
4. **Clean Up**: Delete resources when not in use to minimize costs
5. **Explore Athena**: Use Athena to validate your data transformations

---

**Happy Learning! ğŸ‰**

For detailed setup instructions, see [docs/README-LOCAL-SETUP.md](docs/README-LOCAL-SETUP.md)
